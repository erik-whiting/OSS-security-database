from db.database import Query

class RepoVulnerability:
  def __init__(self, repo, vulnerability):
    self.repo = repo
    self.repo_commit_analyzed = repo.get_latest_commit()
    self.vulnerability = vulnerability

  def insert(self):
    columns = [
      'repository_id',
      'latest_commit_analyzed',
      'name_of_vulnerability'
    ]
    
    insertable_vulnerability = self.vulnerability.replace('\'', '\'\'')
    insert_values = [
      self.repo.id,
      f"'{self.repo_commit_analyzed}'",
      f"'{insertable_vulnerability}'"
    ]
    
    q = Query()
    q.insert(
      'repo_vulnerabilities',
      columns,
      insert_values
    )
